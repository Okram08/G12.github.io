<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>G12 Mint dApp</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
  <style>
    body { font-family: Arial; padding: 40px; max-width: 600px; margin: auto; }
    button, input { margin: 10px 0; padding: 10px; width: 100%; }
    .connected { color: green; }
  </style>
</head>
<body>
  <h1>Mint G12 Tokens</h1>
  <button id="connectButton">Connect Wallet</button>
  <div id="walletInfo" style="display: none">
    <p>Connected: <span id="walletAddress" class="connected"></span></p>
    <label>Amount of USDC to deposit:</label>
    <input type="number" id="usdcAmount" placeholder="Enter USDC amount" />
    <button id="mintButton">Mint G12</button>
    <button id="withdrawButton">Withdraw USDC</button>
  </div>

  <script>
    let signer;
    let provider;

    // Replace with actual contract address and ABI
    const G12_CONTRACT_ADDRESS = "0xYourG12Contract";
    const USDC_CONTRACT_ADDRESS = "0xYourUSDCContract";
    const G12_ABI = [
      "function mint(uint256 amount) external",
      "function withdraw(uint256 amount) external"
    ];
    const USDC_ABI = [
      "function approve(address spender, uint256 amount) external returns (bool)",
      "function allowance(address owner, address spender) view returns (uint256)"
    ];

    async function connectWallet() {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        const address = await signer.getAddress();
        document.getElementById("walletAddress").innerText = address;
        document.getElementById("walletInfo").style.display = "block";
      } else {
        alert("Please install Metamask!");
      }
    }

    async function mintG12() {
      const amount = document.getElementById("usdcAmount").value;
      const usdc = new ethers.Contract(USDC_CONTRACT_ADDRESS, USDC_ABI, signer);
      const g12 = new ethers.Contract(G12_CONTRACT_ADDRESS, G12_ABI, signer);
      const parsedAmount = ethers.utils.parseUnits(amount, 6); // USDC has 6 decimals

      // Approve G12 contract to spend user's USDC
      const allowance = await usdc.allowance(await signer.getAddress(), G12_CONTRACT_ADDRESS);
      if (allowance.lt(parsedAmount)) {
        const tx1 = await usdc.approve(G12_CONTRACT_ADDRESS, parsedAmount);
        await tx1.wait();
      }

      // Mint G12 tokens
      const tx2 = await g12.mint(parsedAmount);
      await tx2.wait();
      alert("Minted G12 successfully!");
    }

    async function withdrawG12() {
      const amount = document.getElementById("usdcAmount").value;
      const g12 = new ethers.Contract(G12_CONTRACT_ADDRESS, G12_ABI, signer);
      const parsedAmount = ethers.utils.parseUnits(amount, 6);

      const tx = await g12.withdraw(parsedAmount);
      await tx.wait();
      alert("Withdrawal requested!");
    }

    document.getElementById("connectButton").onclick = connectWallet;
    document.getElementById("mintButton").onclick = mintG12;
    document.getElementById("withdrawButton").onclick = withdrawG12;
  </script>
</body>
</html>
